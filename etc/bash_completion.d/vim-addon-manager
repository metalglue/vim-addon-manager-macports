# vim-addons completion script for vim-addons
# 
# Copyright (c) 2007, Antonio Terceiro <terceiro@softwarelivre.org>
# 
# This program is free software, you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 2 as published by the
# Free Software Foundation; either version 2 of the License, or (at your
# option) any later version.

_complete_vim_addons() {

  COMPREPLY=()
  cur=${COMP_WORDS[COMP_CWORD]}
  prev=${COMP_WORDS[COMP_CWORD-1]}

  commands="list status install remove disable amend files show"
  options="-h --help -r --registry-dir -s --source-dir -t --target-dir -v --verbose -y --system-dir -w --system-wide"

  # complete option names
  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $( compgen -W "$options" -- $cur) )
    return 0
  fi

  case "$prev" in

    # complete commands
    vim-addons)
      COMPREPLY=( $( compgen -W "$commands" -- $cur ) )
      return 0
      ;;

    # complete directory names
    -r|--registry-dir|-s|--source-dir|-t|--target-dir|-y|--system-dir)
      COMPREPLY=( $( compgen -o dirnames -- $cur ) )
      return 0
      ;;

    # complete addon names
    *)
      COMPREPLY=($(grep -h "^addon: $cur" /usr/share/vim/registry/*.yaml | sed -e 's/^addon:\s*//'))

      return 0
      ;;
  esac


}

complete -F _complete_vim_addons -o default vim-addons

